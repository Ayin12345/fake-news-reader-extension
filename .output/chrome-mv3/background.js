var background=function(){"use strict";var w,y;async function I(r,s){var a;const t=await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:r}]})})).json();if(t.choices&&t.choices[0]&&t.choices[0].message.content)return t.choices[0].message.content;throw new Error(((a=t.error)==null?void 0:a.message)||"No response from OpenAI")}async function A(r,s){var a;const e=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:r}]}],generationConfig:{temperature:.7,maxOutputTokens:1e3}})});if(!e.ok){const n=await e.text();throw new Error(`Gemini API error: ${e.status} ${e.statusText} - ${n}`)}const t=await e.json();if(t.candidates&&t.candidates[0]&&t.candidates[0].content&&t.candidates[0].content.parts&&t.candidates[0].content.parts[0])return t.candidates[0].content.parts[0].text;throw new Error(((a=t.error)==null?void 0:a.message)||"No response from Gemini")}async function b(r,s){var e;console.log("Llama API Key:","Present"),console.log("API Key length:",s.length);try{const t=await fetch("https://api-inference.huggingface.co/models/meta-llama/Llama-3.3-70B-Instruct",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:r,parameters:{max_new_tokens:500,temperature:.7,return_full_text:!1}})});if(console.log("Llama Response Status:",t.status,t.statusText),!t.ok){const n=await t.text();throw console.error("Llama API Full Error:",{status:t.status,statusText:t.statusText,errorText:n,headers:Object.fromEntries(t.headers.entries())}),new Error(`Llama API error: ${t.status} ${t.statusText} - ${n}`)}const a=await t.json();if(console.log("Llama API Response Data:",a),Array.isArray(a)&&((e=a[0])!=null&&e.generated_text))return a[0].generated_text;throw console.error("Llama API Invalid Response Format:",a),new Error(a.error||"No valid response from Llama")}catch(t){throw console.error("Llama API Call Failed:",t),t}}async function v(r,s){const e=await fetch("https://api.cohere.ai/v1/generate",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({model:"command",prompt:r,max_tokens:1250})});if(!e.ok)throw new Error(`Cohere API error: ${e.status} ${e.statusText}`);const t=await e.json();if(t.generations&&t.generations[0]&&t.generations[0].text)return t.generations[0].text;throw new Error(t.message||"No response from Cohere")}async function _(r,s){var e;try{const t=await fetch("https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.3",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:r,parameters:{max_new_tokens:500,temperature:.7,return_full_text:!1}})});if(console.log("Mistral Response Status:",t.status,t.statusText),!t.ok){const n=await t.text();throw console.error("Mistral API Full Error:",{status:t.status,statusText:t.statusText,errorText:n,headers:Object.fromEntries(t.headers.entries())}),new Error(`Mistral API error: ${t.status} ${t.statusText} - ${n}`)}const a=await t.json();if(console.log("Mistral API Response Data:",a),Array.isArray(a)&&((e=a[0])!=null&&e.generated_text))return a[0].generated_text;throw console.error("Mistral API Invalid Response Format:",a),new Error(a.error||"No valid response from Mistral 7B")}catch(t){throw console.error("Mistral API Call Failed:",t),t}}async function E(r,s){try{const e=await fetch("https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:r,parameters:{max_new_tokens:500,temperature:.7,return_full_text:!1}})});if(console.log("Mixtral Response Status:",e.status,e.statusText),!e.ok){const a=await e.text();throw console.error("Mixtral API Full Error:",{status:e.status,statusText:e.statusText,errorText:a,headers:Object.fromEntries(e.headers.entries())}),new Error(`Mixtral API error: ${e.status} ${e.statusText} - ${a}`)}const t=await e.json();if(console.log("Mixtral API Response Data:",t),Array.isArray(t)&&t[0]&&t[0].generated_text)return t[0].generated_text;throw console.error("Mixtral API Invalid Response Format:",t),new Error(t.error||"No response from Mixtral 8x7B")}catch(e){throw console.error("Mixtral API Call Failed:",e),e}}function P(r){return r==null||typeof r=="function"?{main:r}:r}async function k(r,s=5){var e;try{const t=`${r} fact check verification -fake -hoax site:(reuters.com OR apnews.com OR snopes.com OR factcheck.org OR politifact.com)`,a=await fetch(`https://www.googleapis.com/customsearch/v1?key=AIzaSyAIQCMO6dv-Ywnqfv2ctmV-UlBD3z1xHzI&cx=c424f03b2cfd34523&q=${encodeURIComponent(t)}&num=${s}&fields=items(title,snippet,link)&dateRestrict=m3`);if(!a.ok)throw new Error(`Search API error: ${a.status}`);return((e=(await a.json()).items)==null?void 0:e.map(l=>({url:l.link,title:l.title,snippet:l.snippet})))||[]}catch(t){return console.error("Web search failed:",t),[]}}const i=new Map,u=()=>({pageInfo:null,analysis:[],failedProviders:[],showButton:!0}),O=P({main(){chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed")}),chrome.action.onClicked.addListener(()=>{chrome.sidePanel.open({windowId:chrome.windows.WINDOW_ID_CURRENT})}),chrome.tabs.onRemoved.addListener(r=>{i.delete(r)}),chrome.runtime.onMessage.addListener((r,s,e)=>r.type==="GET_PAGE_INFO"?((async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){e({success:!1,error:"No active tab found"});return}const a=await chrome.tabs.sendMessage(t.id,{type:"GET_PAGE_CONTENT"});if(a&&a.error){e({success:!1,error:a.error});return}let n=i.get(t.id)||u();n={...n,pageInfo:a.data,showButton:!0,analysis:[],failedProviders:[]},i.set(t.id,n),e({success:!0,data:a.data})}catch{e({success:!1,error:"Failed to fetch page info"})}})(),!0):r.type==="ANALYZE_ARTICLE"?((async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){e({success:!1,error:"No active tab found"});return}const a=r.providers||[],n=await Promise.allSettled(a.map(async o=>{switch(o){case"OpenAI":return await I(r.content,"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");case"Gemini":return await A(r.content,"AIzaSyA82I5_GdxU23af9sklb3mLb8T-tuPP1BE");case"Cohere":return await v(r.content,"d4rtWmY3HK9su8mrSbxlsrWEJod7TZyGeNH3ZvdG");case"Mistral7B":return await _(r.content,"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");case"Mixtral8x7B":return await E(r.content,"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");case"Llama":return await b(r.content,"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");default:throw new Error(`Unknown provider: ${o}`)}})),l=n.map((o,p)=>{if(o.status==="fulfilled")try{let c;if(typeof o.value=="string")try{c=JSON.parse(o.value)}catch{const g=o.value.match(/credibility_score["\s:]+(\d+)/),x=o.value.match(/reasoning["\s:]+(.+?)(?=supporting_links|$)/s),T=o.value.match(/supporting_links["\s:]+\[(.*?)\]/s);c={credibility_score:g?parseInt(g[1]):0,reasoning:x?x[1].trim().replace(/['"]+/g,""):o.value,supporting_links:T?T[1].split(",").map(m=>m.trim().replace(/['"]+/g,"")).filter(m=>m.length>0):[]}}else c=o.value;return c?{provider:a[p],result:c}:null}catch{return null}return null}).filter(o=>o!==null),B=n.map((o,p)=>o.status==="rejected"?a[p]:null).filter(o=>o!==null),f=i.get(t.id)||u();f.analysis=l,f.failedProviders=B,f.showButton=!1,i.set(t.id,f),e({success:!0,data:n,providers:a})}catch{e({success:!1,error:"Failed to analyze article"})}})(),!0):r.type==="GET_TAB_STATE"?((async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){e({success:!1,error:"No active tab found"});return}const a=i.get(t.id)||u();e({success:!0,data:a})}catch{e({success:!1,error:"Failed to get tab state"})}})(),!0):r.type==="RESET_TAB_STATE"?((async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){e({success:!1,error:"No active tab found"});return}i.set(t.id,u()),e({success:!0})}catch{e({success:!1,error:"Failed to reset tab state"})}})(),!0):r.type==="SAVE_TAB_STATE"?((async()=>{try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t!=null&&t.id)){e({success:!1,error:"No active tab found"});return}i.set(t.id,{pageInfo:r.data.pageInfo,analysis:r.data.analysis,failedProviders:r.data.failedProviders,showButton:r.data.showButton}),e({success:!0})}catch{e({success:!1,error:"Failed to save tab state"})}})(),!0):(r.type==="WEB_SEARCH"&&(async()=>{try{const t=await k(r.query,r.max_results);e({success:!0,data:{results:t}})}catch(t){console.error("Web search error:",t),e({success:!1,error:"Failed to perform web search"})}})(),!0))}});function M(){}(y=(w=globalThis.browser)==null?void 0:w.runtime)!=null&&y.id?globalThis.browser:globalThis.chrome;function d(r,...s){}const S={debug:(...r)=>d(console.debug,...r),log:(...r)=>d(console.log,...r),warn:(...r)=>d(console.warn,...r),error:(...r)=>d(console.error,...r)};let h;try{h=O.main(),h instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw S.error("The background crashed on startup!"),r}return h}();
background;
