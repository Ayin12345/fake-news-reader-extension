var background=function(){"use strict";var U,q;function R(e){return e==null||typeof e=="function"?{main:e}:e}async function Y(e,o){var s;console.time("[AI] OpenAI request");const t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:e}]})});console.timeEnd("[AI] OpenAI request");const a=await t.json();if(a.choices&&a.choices[0]&&a.choices[0].message.content)return a.choices[0].message.content;throw new Error(((s=a.error)==null?void 0:s.message)||"No response from OpenAI")}async function $(e,o,t){var r;console.time(`[AI] Gemini ${t} request`);const a=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${t}:generateContent?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:e}]}],generationConfig:{temperature:.7,maxOutputTokens:6e3}})});if(console.timeEnd(`[AI] Gemini ${t} request`),!a.ok){const n=await a.text();throw new Error(`Gemini ${t} API error: ${a.status} ${a.statusText} - ${n}`)}const s=await a.json();if(console.log(`Gemini ${t} API Response Data:`,JSON.stringify(s,null,2)),s.candidates&&s.candidates[0]){const n=s.candidates[0];if(n.finishReason==="MAX_TOKENS")throw new Error(`Gemini ${t} response was truncated due to token limit. Try reducing your input length.`);if(n.finishReason==="SAFETY")throw new Error(`Gemini ${t} response was blocked due to safety filters.`);if(n.content&&n.content.parts&&n.content.parts[0]&&n.content.parts[0].text)return n.content.parts[0].text;if(n.content&&n.content.text)return n.content.text;throw new Error(`Gemini ${t} response incomplete. Finish reason: ${n.finishReason||"unknown"}`)}else throw console.error(`Gemini ${t} response structure:`,s),new Error(((r=s.error)==null?void 0:r.message)||`No candidates in Gemini ${t} response`)}async function Q(e,o){try{return console.log("[AI] Trying Gemini 2.5 Flash..."),await $(e,o,"gemini-2.5-flash")}catch(t){console.warn("[AI] Gemini 2.5 Flash failed, trying backup model:",t);try{return console.log("[AI] Trying Gemini 1.5 Pro as backup..."),await $(e,o,"gemini-2.5-flash-lite")}catch(a){throw console.error("[AI] Both Gemini models failed:",a),new Error("Analysis failed due to AI model limitations. Please try with a shorter article or try again later.")}}}console.log("[WebSearch] Module loaded - web search tracking is active");async function J(e){var o,t,a,s,r,n;try{const i=`Given this article title: "${e}"

Generate a simple Google search query to find related news articles and fact-checking content.

Instructions:
- Extract the main person, place, or event from the title
- Create a simple query with 2-4 key words
- Focus on the most important elements (names, locations, events)
- Avoid complex operators or restrictions
- Make it broad enough to find results but specific enough to be relevant

Examples:
- For "Staten Island man arrested at Zohran Mamdani's anti-Trump event" â†’ "Zohran Mamdani Staten Island arrest"
- For Bad Bunny to Perform at Apple Music 2026 Super Bowl Halftime Show â†’ focus on Bad Bunny and Super Bowl, not Apple Music or 2026
- For "Vaccine safety claims verified" â†’ "vaccine safety verification"

Return ONLY the search query, nothing else.`,l=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=AIzaSyDPDnXHi6y7weR-_9GB-yE9zeEp9M17fNM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],generationConfig:{temperature:.3,maxOutputTokens:100}})});if(!l.ok){console.error("Gemini API error:",l.status,l.statusText);const g=await l.text();return console.error("Gemini API error details:",g),console.log("[WebSearch] Falling back to basic pattern due to API error"),`"${e}" fact check`}const u=(n=(r=(s=(a=(t=(o=(await l.json()).candidates)==null?void 0:o[0])==null?void 0:t.content)==null?void 0:a.parts)==null?void 0:s[0])==null?void 0:r.text)==null?void 0:n.trim();return u||`"${e}" fact check`}catch(i){return console.error("Failed to generate AI query:",i),`"${e}" fact check`}}async function H(e,o=5){try{const t=e.replace(/https?:\/\/[^\s]+/g,"").trim();let a="",s=null;try{const c=e.match(/https?:\/\/[^\/]+/);c&&(a=c[1].replace("www.",""));const m=e.match(/\/(20\d{2})\//);if(m)s=parseInt(m[1]);else{const p=e.match(/(20\d{2})/);p&&(s=parseInt(p[1]))}}catch{}const r=await J(t);console.log("[WebSearch] AI generated query:",r);const n=a?`${r} -site:${a}`:r;console.log("[WebSearch] Final query (with domain exclusion):",n);const l=`https://www.googleapis.com/customsearch/v1?${new URLSearchParams({key:"AIzaSyAIQCMO6dv-Ywnqfv2ctmV-UlBD3z1xHzI",cx:"c424f03b2cfd34523",q:n,num:Math.min(10,o).toString(),fields:"items(title,snippet,link)"}).toString()}`,d=await fetch(l);if(!d.ok){if(console.error("Google search failed:",d.status,d.statusText),d.status===403)console.error("API quota exceeded or access denied. Check your Google Custom Search API key and quota.");else if(d.status===400){console.error("Bad request - check API parameters");const c=await d.text();console.error("Error response:",c)}return{results:[],searchMethod:"fallback",queryUsed:n,aiQueryGenerated:r,fallbackQueryUsed:`Google API error: ${d.status}`}}let g=((await d.json()).items||[]).filter(c=>{var W;if(!(c!=null&&c.link)||a&&c.link.toLowerCase().includes(a)||c.link.toLowerCase()===e.toLowerCase())return!1;const m=["4chan.org","8kun.top","gab.com","parler.com","truthsocial.com"],p=new URL(c.link).hostname.toLowerCase();if(m.some(f=>p.includes(f)))return!1;const O=new URL(c.link).pathname.match(/\/(20\d{2})\//);if(O){const f=parseInt(O[1]);if(s&&f!==s)return!1}if([/\/20(0[0-9]|1[0-5])\//,/archive\./,/old\./,/legacy\./].some(f=>f.test(c.link)))return!1;const y=["fact","check","verify","debunk","hoax","fake","false","misleading","analysis","investigation","truth","reality","claim","rumor"],T=`${c.title||""} ${c.snippet||""}`.toLowerCase(),k=y.some(f=>T.includes(f)),v=["snopes.com","factcheck.org","politifact.com","reuters.com","ap.org","bbc.com","bbc.co.uk","nytimes.com","washingtonpost.com","wsj.com","npr.org","pbs.org","abcnews.go.com","cbsnews.com","nbcnews.com","cnn.com","foxnews.com","msnbc.com","abc.net.au","theguardian.com","independent.co.uk","telegraph.co.uk","economist.com","time.com","newsweek.com","usatoday.com","latimes.com","chicagotribune.com"].some(f=>p.includes(f)),ye=t.toLowerCase(),C=t.split(" ").filter(f=>{const V=f.toLowerCase();return f.length>3&&!["the","and","for","with","from","that","this","have","been","they","were","said","news","article","report","story"].includes(V)&&(f[0]===f[0].toUpperCase()||V.length>5)}).map(f=>f.toLowerCase());console.log("[WebSearch] Key entities extracted:",C);const M=C.filter(f=>T.includes(f));console.log("[WebSearch] Entity matches found:",M,"for result:",c.title);const j=M.length>=2||M.length>=1&&C.some(f=>f.includes(" ")),z=k||v||j;return console.log("[WebSearch] Result evaluation:",{title:((W=c.title)==null?void 0:W.substring(0,50))+"...",hasRelevantKeywords:k,isFromTrustedDomain:v,hasStrongEntityMatch:j,shouldInclude:z}),z}).map(c=>({url:c.link,title:c.title,snippet:c.snippet})).filter((c,m,p)=>m===p.findIndex(I=>I.url===c.url)).slice(0,o);if(g.length>0)return console.log("[WebSearch] Returning",g.length,"results from AI-generated query"),{results:g,searchMethod:"ai-generated",queryUsed:n,aiQueryGenerated:r};console.log("[WebSearch] No results from AI query, trying fallback strategies...");const h=[`"${t}" fact check`,`${t} verification`,`${t} debunked`,`${t} news analysis`,t];for(const c of h){console.log("[WebSearch] Trying fallback query:",c);const p=`https://www.googleapis.com/customsearch/v1?${new URLSearchParams({key:"AIzaSyAIQCMO6dv-Ywnqfv2ctmV-UlBD3z1xHzI",cx:"c424f03b2cfd34523",q:c,num:Math.min(10,o).toString(),fields:"items(title,snippet,link)"}).toString()}`;try{const I=await fetch(p);if(I.ok){const N=((await I.json()).items||[]).filter(y=>{if(!(y!=null&&y.link)||a&&y.link.toLowerCase().includes(a))return!1;const T=["4chan.org","8kun.top","gab.com","parler.com","truthsocial.com"],k=new URL(y.link).hostname.toLowerCase();if(T.some(E=>k.includes(E)))return!1;const v=new URL(y.link).pathname.match(/\/(20\d{2})\//);if(v){const E=parseInt(v[1]);if(s&&E!==s)return!1}return![/\/20(0[0-9]|1[0-5])\//,/archive\./,/old\./,/legacy\./].some(E=>E.test(y.link))}).map(y=>({url:y.link,title:y.title,snippet:y.snippet})).filter((y,T,k)=>T===k.findIndex(L=>L.url===y.url)).slice(0,o);if(N.length>0)return console.log("[WebSearch] Returning",N.length,"results from fallback query:",c),{results:N,searchMethod:"fallback",queryUsed:c,aiQueryGenerated:r,fallbackQueryUsed:c}}}catch(I){console.error(`Fallback query "${c}" failed:`,I);continue}}return console.log("[WebSearch] No results found from any strategy"),{results:[],searchMethod:"fallback",queryUsed:"No successful query",aiQueryGenerated:r,fallbackQueryUsed:"All fallback queries failed"}}catch(t){return console.error("AI-powered web search failed:",t),{results:[],searchMethod:"fallback",queryUsed:"Error occurred",aiQueryGenerated:"Failed to generate",fallbackQueryUsed:"Error before fallback"}}}const A=new Map,_=new Map,G=new Set,S=()=>({pageInfo:null,analysis:[],failedProviders:[],showButton:!0,isAnalyzing:!1,hasAttemptedAnalysis:!1});async function b(e,o){try{const a=(await chrome.storage.local.get("tabStates")).tabStates||{};a[e]=o,await chrome.storage.local.set({tabStates:a}),A.set(e,o)}catch(t){console.error("Failed to save tab state:",t),A.set(e,o)}}async function P(e){if(A.has(e))return A.get(e);try{const a=((await chrome.storage.local.get("tabStates")).tabStates||{})[e];if(a)return A.set(e,a),a}catch(o){console.error("Failed to get tab state:",o)}}async function B(e){try{const t=(await chrome.storage.local.get("tabStates")).tabStates||{};delete t[e],await chrome.storage.local.set({tabStates:t}),A.delete(e)}catch(o){console.error("Failed to delete tab state:",o),A.delete(e)}}function X(e){return _.get(e)}function x(e,o){_.set(e,o)}function Z(e){return G.has(e)}function K(e){G.add(e)}function w(e){G.delete(e)}const ee=()=>{const e=Date.now(),o=24*60*60*1e3;for(const[t,a]of _.entries())e-a.timestamp>o&&_.delete(t)},te=async()=>{try{const o=(await chrome.storage.local.get("tabStates")).tabStates||{},t=await chrome.tabs.query({}),a=new Set(t.map(r=>r.id));let s=!1;for(const r of Object.keys(o))a.has(parseInt(r))||(delete o[r],s=!0);s&&(await chrome.storage.local.set({tabStates:o}),console.log("Cleaned up old tab states"))}catch(e){console.error("Error cleaning up tab states:",e)}};function re(e){try{return JSON.parse(e)}catch{try{let t=e.trim();const a=t.indexOf("{"),s=t.lastIndexOf("}")+1;a>=0&&s>a&&(t=t.slice(a,s)),t=t.replace(/\\n/g," ").replace(/\s+/g," ").replace(/"\s*,\s*}/g,'"}').replace(/,(\s*})/g,"$1").replace(/\.,/g,".").replace(/\."/g,'"').replace(/"\s*\.\s*$/g,'"').replace(/\[\s*,/g,"[").replace(/,\s*\]/g,"]");const r=JSON.parse(t);return r.credibility_summary&&(r.credibility_summary=r.credibility_summary.trim().replace(/\s+/g," ").replace(/\.,/g,".").replace(/\.+$/,".")),r.reasoning&&(r.reasoning=r.reasoning.trim().replace(/\s+/g," ").replace(/\.,/g,".").replace(/\.+$/,".")),Array.isArray(r.evidence_sentences)&&(r.evidence_sentences=r.evidence_sentences.map(n=>{var i,l;return{quote:((i=n.quote)==null?void 0:i.trim().replace(/\s+/g," ").replace(/\.+$/,""))||"",impact:((l=n.impact)==null?void 0:l.trim().replace(/\s+/g," ").replace(/\.+$/,""))||""}}).filter(n=>n.quote&&n.impact)),Array.isArray(r.supporting_links)&&(r.supporting_links=r.supporting_links.map(n=>n.trim()).filter(Boolean)),typeof r.credibility_score=="string"&&(r.credibility_score=parseInt(r.credibility_score,10)),r.credibility_score=Math.max(1,Math.min(100,r.credibility_score||0)),r}catch(t){throw console.error("Failed to parse cleaned JSON:",t),new Error("Invalid JSON format")}}}function ae(e,o){const t=e.map((s,r)=>{if(s.status==="fulfilled")try{let n;if(typeof s.value=="string")try{n=re(s.value)}catch(i){return console.error("Failed to parse result:",i),null}else n=s.value;return n?typeof n.credibility_score!="number"||typeof n.credibility_summary!="string"||typeof n.reasoning!="string"||!Array.isArray(n.evidence_sentences)||!Array.isArray(n.supporting_links)?(console.error("Invalid result structure:",n),null):{provider:o[r],result:n}:(console.error("No parsed result available"),null)}catch(n){return console.error(`Error processing result from provider ${o[r]}:`,n),null}return null}).filter(s=>s!==null),a=e.map((s,r)=>s.status==="rejected"?(console.error(`Provider ${o[r]} failed:`,s.reason),o[r]):null).filter(s=>s!==null);return{successfulResults:t,failedProviders:a}}async function ne(e,o,t){var a,s;try{const r=e.tabId||((a=o.tab)==null?void 0:a.id);if(!r){t({success:!1,error:"No tab ID found"});return}const n=await chrome.tabs.sendMessage(r,{type:"GET_PAGE_CONTENT"});if(n&&n.error){t({success:!1,error:n.error});return}let i=await P(r)||S();const l=((s=i.pageInfo)==null?void 0:s.url)===n.data.url;i={...i,pageInfo:n.data,showButton:!0,analysis:l?i.analysis:[],failedProviders:l?i.failedProviders:[],hasAttemptedAnalysis:!1},await b(r,i),t({success:!0,data:n.data})}catch(r){console.error("Error getting page info:",r),t({success:!1,error:"Failed to fetch page info"})}}async function se(e,o,t){try{console.log("[NewsScan] handleAnalyzeArticle called with:",e);const a=e.tabId;if(!a){t({success:!1,error:"No tab ID provided"});return}const s=e.providers||[];console.log("[NewsScan] Providers to use:",s);let r=await P(a)||S();r.isAnalyzing=!0,await b(a,r);const n=s.map(async g=>{try{let h;switch(g){case"OpenAI":h=await Y(e.content,"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");break;case"Gemini":h=await Q(e.content,"AIzaSyDPDnXHi6y7weR-_9GB-yE9zeEp9M17fNM");break;default:throw new Error(`Unknown provider: ${g}`)}return chrome.runtime.sendMessage({type:"PROVIDER_UPDATE",provider:g,status:"complete"}),h}catch(h){console.error(`Error in provider ${g}:`,h);const c=h instanceof Error?h.message:"Provider failed";chrome.runtime.sendMessage({type:"PROVIDER_UPDATE",provider:g,status:"failed",error:c});let m=await P(a);if(m){const p={...m,error:c,isAnalyzing:!1};await b(a,p)}throw h}}),i=await Promise.allSettled(n),{successfulResults:l,failedProviders:d}=ae(i,s);let u=await P(a);u||(console.warn("No existing tab state found during analysis"),u=S()),u.analysis=l,u.failedProviders=d,u.showButton=!1,u.isAnalyzing=!1,u.hasAttemptedAnalysis=!0,await b(a,u),t({success:!0,data:{successfulResults:l,failedProviders:d},providers:s})}catch(a){console.error("Error in analyze article:",a),t({success:!1,error:"Failed to analyze article"})}}async function oe(e,o,t){var a,s;try{const r=e.tabId||((a=o.tab)==null?void 0:a.id);if(!r){t({success:!1,error:"No tab ID found"});return}if(e.url){const i=X(e.url);if(i){const u={pageInfo:i.pageInfo,analysis:i.analysis,failedProviders:i.failedProviders,showButton:!1,isAnalyzing:!1,hasAttemptedAnalysis:!0,isViewingFromRecent:!0,originalTabId:void 0};await b(r,u),t({success:!0,data:u});return}const d=(await chrome.storage.local.get("tabStates")).tabStates||{};for(const[u,g]of Object.entries(d)){const h=g;if(((s=h.pageInfo)==null?void 0:s.url)===e.url&&h.analysis&&h.analysis.length>0){t({success:!0,data:h});return}}t({success:!0,data:S()});return}const n=await P(r)||S();t({success:!0,data:n})}catch(r){console.error("Error in GET_TAB_STATE:",r),t({success:!1,error:"Failed to get tab state"})}}async function ie(e,o,t){var a;try{const s=e.tabId||((a=o.tab)==null?void 0:a.id);if(!s){t({success:!1,error:"No tab ID found"});return}await B(s);const r=S();await b(s,r),chrome.tabs.sendMessage(s,{type:"TAB_SWITCHED",state:r}).catch(()=>{}),t({success:!0})}catch(s){console.error("Error resetting tab state:",s),t({success:!1,error:"Failed to reset tab state"})}}async function ce(e,o,t){var a,s;try{const r=e.tabId||((a=o.tab)==null?void 0:a.id);if(!r){t({success:!1,error:"No tab ID available to save state"});return}await b(r,{pageInfo:e.data.pageInfo,analysis:e.data.analysis,failedProviders:e.data.failedProviders,showButton:e.data.showButton,isAnalyzing:e.data.isAnalyzing||!1,hasAttemptedAnalysis:e.data.hasAttemptedAnalysis||!1,isViewingFromRecent:e.data.isViewingFromRecent||!1,originalTabId:e.data.originalTabId}),(s=e.data.pageInfo)!=null&&s.url&&e.data.analysis&&e.data.analysis.length>0&&x(e.data.pageInfo.url,{pageInfo:e.data.pageInfo,analysis:e.data.analysis,failedProviders:e.data.failedProviders,timestamp:Date.now()}),t({success:!0})}catch{t({success:!1,error:"Failed to save tab state"})}}async function le(e,o,t){try{const a=e.originalUrl?`${e.query} ${e.originalUrl}`:e.query,s=await H(a,e.max_results);t({success:!0,data:{results:s}})}catch(a){console.error("Web search error:",a),t({success:!1,error:"Failed to perform web search"})}}async function ue(e,o,t){var a,s;try{const r=e.tabId,n=e.analysisData;if(console.log("ðŸ”„ LOAD_ANALYSIS_IN_TAB called for tab:",r),console.log("ðŸ“„ Analysis data received:",{hasPageInfo:!!n.pageInfo,hasAnalysis:!!n.analysis,analysisLength:((a=n.analysis)==null?void 0:a.length)||0,isViewingFromRecent:n.isViewingFromRecent}),Z(r)){console.log("âš ï¸ Tab already being set up, skipping"),t({success:!1,error:"Tab already being set up"});return}K(r);const i={pageInfo:n.pageInfo,analysis:n.analysis,failedProviders:n.failedProviders,showButton:!1,isAnalyzing:!1,hasAttemptedAnalysis:!0,isViewingFromRecent:n.isViewingFromRecent||!1,originalTabId:n.originalTabId};await b(r,i),(s=n.pageInfo)!=null&&s.url&&x(n.pageInfo.url,{pageInfo:n.pageInfo,analysis:n.analysis,failedProviders:n.failedProviders,timestamp:Date.now()}),await b(r,{...i,hasPreloadedAnalysis:!0}),setTimeout(async()=>{try{try{await chrome.tabs.sendMessage(r,{type:"FNR_PING"})}catch{await chrome.scripting.executeScript({target:{tabId:r},files:["content-scripts/content.js"]})}setTimeout(async()=>{var l;try{if(!await chrome.tabs.get(r)){w(r),t({success:!1,error:"Tab no longer exists"});return}i.isViewingFromRecent?(console.log("ðŸ”„ Sending preloaded analysis to content script for history view"),console.log("ðŸ“„ Preloaded analysis data:",{hasAnalysis:!!i.analysis,analysisLength:((l=i.analysis)==null?void 0:l.length)||0,hasPageInfo:!!i.pageInfo,isViewingFromRecent:i.isViewingFromRecent}),console.log("ðŸ“¤ Sending TOGGLE_INJECTED_SIDEBAR message to tab:",r),chrome.tabs.sendMessage(r,{type:"TOGGLE_INJECTED_SIDEBAR",keepOpen:!0,preloadedAnalysis:i,hasPreloadedAnalysis:!0},u=>{if(chrome.runtime.lastError){w(r),t({success:!1,error:chrome.runtime.lastError.message});return}w(r),t({success:!0})})):(t({success:!0}),w(r))}catch{w(r),t({success:!1,error:"Failed to open sidebar"})}},200)}catch(l){console.error("Error setting up analysis tab:",l),w(r),t({success:!1,error:"Failed to setup analysis tab"})}},1e3)}catch(r){console.error("Error in LOAD_ANALYSIS_IN_TAB:",r),e.tabId&&w(e.tabId),t({success:!1,error:"Failed to load analysis in tab"})}}async function de(e,o,t){try{const a=await chrome.tabs.create({url:e.url});if(!a.id){t({success:!1,error:"Failed to create new tab"});return}const s=a.id;setTimeout(async()=>{try{await chrome.scripting.executeScript({target:{tabId:s},files:["content-scripts/content.js"]}),await new Promise((n,i)=>{const l=setTimeout(()=>{i(new Error("Content script not ready after 5 seconds"))},5e3);chrome.tabs.sendMessage(s,{type:"FNR_PING"},d=>{clearTimeout(l),chrome.runtime.lastError?i(new Error(chrome.runtime.lastError.message)):d!=null&&d.ok?n(!0):i(new Error("Content script not responding"))})}),t({success:!0})}catch(r){console.error("Error in sidebar setup:",r),t({success:!1,error:r instanceof Error?r.message:"Unknown error"})}},1e3)}catch(a){console.error("Error in NAVIGATE_AND_REOPEN_SIDEBAR:",a),t({success:!1,error:"Navigation failed"})}}async function fe(e,o,t){var a,s;try{const{url:r,pageInfo:n,analysis:i,failedProviders:l}=e;if(!r||!i||i.length===0){t({success:!1,error:"Missing url or analysis"});return}x(r,{pageInfo:n,analysis:i,failedProviders:l||[],timestamp:Date.now()});const u=(await chrome.storage.local.get("recentAnalyses")).recentAnalyses||[],g=u.findIndex(m=>m.url===r),h={title:n.title||"Unknown Title",url:r,timestamp:Date.now(),score:((s=(a=i[0])==null?void 0:a.result)==null?void 0:s.credibility_score)||null,fullAnalysis:i,pageInfo:n,failedProviders:l||[]};g>=0?u[g]=h:u.unshift(h);const c=u.slice(0,50);await chrome.storage.local.set({recentAnalyses:c}),t({success:!0})}catch(r){console.error("Error in PRELOAD_URL_ANALYSIS:",r),t({success:!1,error:"Failed to preload analysis"})}}const he=R({main(){chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed")}),setInterval(ee,60*60*1e3),setInterval(te,5*60*1e3),chrome.action.onClicked.addListener(async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(e!=null&&e.id))return;const o=r=>new Promise(n=>{let i=!1;try{chrome.tabs.sendMessage(r,{type:"FNR_PING"},l=>{if(chrome.runtime.lastError){i||(i=!0,n(!1));return}i||(i=!0,n(!!(l!=null&&l.ok)))})}catch{i||(i=!0,n(!1))}setTimeout(()=>{i||(i=!0,n(!1))},400)}),t=async()=>{try{await chrome.tabs.sendMessage(e.id,{type:"TOGGLE_INJECTED_SIDEBAR"})}catch(r){console.log("Toggle send error:",r)}};if(await o(e.id)){await t();return}try{await chrome.scripting.executeScript({target:{tabId:e.id},files:["content-scripts/content.js"]})}catch(r){console.log("Failed to inject content script:",r)}const s=await o(e.id);await t()}catch(e){console.log("Failed to toggle injected sidebar:",e)}}),chrome.tabs.onRemoved.addListener(e=>{B(e),w(e)}),chrome.tabs.onActivated.addListener(async e=>{try{chrome.runtime.sendMessage({type:"TAB_SWITCHED",tabId:e.tabId}).catch(()=>{})}catch(o){console.log("Error handling tab switch:",o)}}),chrome.runtime.onMessage.addListener((e,o,t)=>{switch(e.type){case"GET_PAGE_INFO":return ne(e,o,t),!0;case"ANALYZE_ARTICLE":return se(e,o,t),!0;case"GET_TAB_STATE":return oe(e,o,t),!0;case"RESET_TAB_STATE":return ie(e,o,t),!0;case"SAVE_TAB_STATE":return ce(e,o,t),!0;case"WEB_SEARCH":return le(e,o,t),!0;case"TAB_SWITCHED":return!0;case"LOAD_ANALYSIS_IN_TAB":return ue(e,o,t),!0;case"NAVIGATE_AND_REOPEN_SIDEBAR":return de(e,o,t),!0;case"PRELOAD_URL_ANALYSIS":return fe(e,o,t),!0;default:return!0}}),chrome.tabs.onUpdated.addListener(async(e,o,t)=>{if(o.status==="complete"&&t.url)try{await new Promise(a=>setTimeout(a,1e3))}catch(a){console.error("Error in tab update handler:",a)}})}});function me(){}(q=(U=globalThis.browser)==null?void 0:U.runtime)!=null&&q.id?globalThis.browser:globalThis.chrome;function D(e,...o){}const ge={debug:(...e)=>D(console.debug,...e),log:(...e)=>D(console.log,...e),warn:(...e)=>D(console.warn,...e),error:(...e)=>D(console.error,...e)};let F;try{F=he.main(),F instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw ge.error("The background crashed on startup!"),e}return F}();
background;
