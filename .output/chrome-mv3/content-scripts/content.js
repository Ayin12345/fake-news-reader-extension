var content=function(){"use strict";var O=Object.defineProperty;var _=(f,u,y)=>u in f?O(f,u,{enumerable:!0,configurable:!0,writable:!0,value:y}):f[u]=y;var p=(f,u,y)=>_(f,typeof u!="symbol"?u+"":u,y);var C,q;function f(s){return s}const u={matches:["<all_urls>"],main(){console.log("Content script loaded"),chrome.runtime.onMessage.addListener((t,e,i)=>{if(t.type==="GET_PAGE_CONTENT")return console.log("Processing content on:",window.location.href),document.readyState!=="complete"?(console.log("Page not ready, waiting..."),window.addEventListener("load",()=>{setTimeout(()=>{s(i)},100)}),!0):(setTimeout(()=>{s(i)},500),!0)});function s(t){try{let e=null,i=null,c=0;const d=document.querySelectorAll("article");console.log("Found",d.length,"article tags on page");for(let o=0;o<d.length;o++){const l=d[o],n=l.innerText||"";if(n.includes("LIVE")||n.includes("Resume")||n.includes("Listen")||n.includes("Play")||n.includes("Pause")||n.includes("Volume")||n.includes("WAMU")||n.includes("88.5")||n.includes("HD 88.5")||n.includes("OPEN")||n.includes("TRANSCRIPT")||n.includes("Follow us")||n.includes("Subscribe")||n.includes("Newsletter")||n.includes("Sign up")||n.includes("Menu")||n.includes("Navigation")||n.includes("Search")||l.querySelector('.play-initial, .audio-player, .radio-player, .video-player, .media-player, [class*="player"], [class*="audio"], [class*="video"], [class*="listen"], [class*="resume"]')){console.log(`Article ${o}: SKIPPED (has non-content), text preview: ${n.substring(0,100)}`);continue}let m=0;m+=Math.min(n.length/10,50);const U=l.querySelectorAll("p");m+=U.length*5;const R=l.querySelectorAll("h1, h2, h3, h4, h5, h6");m+=R.length*3,l.querySelectorAll("a").length>20&&(m-=20),(l.className.includes("story")||l.className.includes("article")||l.className.includes("content")||l.className.includes("post"))&&(m+=20),(l.id.includes("story")||l.id.includes("article")||l.id.includes("content")||l.id.includes("post"))&&(m+=15);const F=n.trim().split(/\s+/).filter(V=>V.length>0).length;console.log(`Article ${o}: score=${m}, words=${F}, text preview: ${n.substring(0,100)}`),m>c&&n.length>100&&F>=50&&(c=m,i=l)}if(i?(e=i,console.log(`Selected best article with score ${c}`),console.log("Selected article text preview:",i.innerText.substring(0,200))):console.log("No suitable article found, will use fallback selectors"),!e){console.log("No suitable article found, trying alternative selectors...");const o=document.querySelector('main, [role="main"], .main-content, .content-main');if(o)console.log("Found main content area, using that"),e=o;else{const l=['[role="main"]',"main",".content",".main-content",".page-content",".article-content",".story-content",".post-content",".entry-content",".article-body",".story-body",".post-body",".entry-body",".content-body",".content-wrapper",".article-wrapper",".story-wrapper",".post-wrapper",".article-text",".story-text",".post-text",".entry-text"];for(const n of l)if(e=document.querySelector(n),e){console.log("Found content using selector:",n);break}}}if(!e){console.log("No article tag found, trying fallback selectors...");const o=["body","#content",".page-content",".main-content"];for(const l of o)if(e=document.querySelector(l),e){console.log("Found content using fallback selector:",l);break}if(!e){t({error:"Unable to extract content from this page."});return}}const a=e.cloneNode(!0);a.querySelectorAll("script, style, noscript").forEach(o=>o.remove()),["nav","header","footer",".navigation",".nav",".menu",".sidebar",".related",".share",".social",".breadcrumb",'[role="navigation"]','[role="banner"]','[role="contentinfo"]',".tags",".categories",".metadata",".byline",".author-info",".related-terms",".details",".share-buttons",".video-player",".audio-player",".media-player",".video-container",".audio-container",".media-container",".player",".livestream",".live-player",".video-embed","[data-video]","[data-audio]","[data-player]",".advertisement",".ad",".ads",".promo",".trending",".more-stories",".recommended",".newsletter",".subscription",".toolbar",".comments",".social-share",".caas-carousel",".caas-readmore",".caas-attr-meta","[data-module]",".photo-credit",".story-meta",".story-byline",".story-timestamp",".audio-module",".video-module",".media-credit",".listen-live",".radio-player",".wamu-player",".resume-listening",".audio-controls",".player-controls",'[class*="player"]','[class*="audio"]','[class*="listening"]','[id*="player"]','[id*="audio"]','[id*="radio"]'].forEach(o=>{a.querySelectorAll(o).forEach(l=>l.remove())});const g=a.querySelector('#storytext, .storytext, .story-text, .story-body, .article-body, .content-body, .story-content, .article-content, [class*="story"], [id*="story"]');let h="";if(console.log("=== DETAILED DEBUG ==="),console.log("Looking for storytext div..."),console.log("storytextDiv found:",!!g),console.log("All divs in article:",a.querySelectorAll("div").length),console.log('All elements with "story" in class or id:'),a.querySelectorAll('[class*="story"], [id*="story"]').forEach((o,l)=>{console.log(`  ${l}: ${o.tagName} id="${o.id}" class="${o.className}"`)}),console.log('All elements with "text" in class or id:'),a.querySelectorAll('[class*="text"], [id*="text"]').forEach((o,l)=>{console.log(`  ${l}: ${o.tagName} id="${o.id}" class="${o.className}"`)}),console.log("Article tag innerHTML length:",a.innerHTML.length),console.log("Article tag innerText length:",a.innerText.length),console.log("Article tag innerText preview:",a.innerText.substring(0,300)),console.log("All direct children of article:",a.children.length),Array.from(a.children).forEach((o,l)=>{console.log(`  Child ${l}: ${o.tagName} id="${o.id}" class="${o.className}"`)}),g&&(console.log("storytextDiv tagName:",g.tagName),console.log("storytextDiv id:",g.id),console.log("storytextDiv classes:",g.className),console.log("storytextDiv innerText preview:",g.innerText.substring(0,200))),g){console.log("Found storytext div, extracting from there");const o=g.querySelectorAll("p");console.log("Paragraphs in storytext:",o.length),o.forEach((l,n)=>{const r=l.innerText.trim();console.log(`Paragraph ${n}:`,r.substring(0,100)),r.length>20&&!r.includes("Advertisement")&&r.split(" ").length>3?(h+=r+" ",console.log(`✓ Added paragraph ${n} to content`)):console.log(`✗ Skipped paragraph ${n} (length: ${r.length}, words: ${r.split(" ").length})`)})}else{console.log("No storytext div found, using fallback method");const o=a.querySelectorAll("p");console.log("Total paragraphs found in article:",o.length),o.length>0&&o.forEach((l,n)=>{const r=l.innerText.trim();console.log(`Fallback paragraph ${n}:`,r.substring(0,100)),r.length>20&&!r.includes("Advertisement")&&!r.includes("©")&&!r.includes("Subscribe")&&!r.includes("Follow us")&&!r.includes("Live Radio")&&!r.includes("ClosedDisplay")&&!r.includes("LIVE")&&!r.includes("ON AIR")&&!r.includes("Listen Live")&&!r.includes("WAMU")&&!r.includes("88.5")&&!r.includes("HD 88.5")&&!r.includes("ListeningWAMU")&&!r.includes("The Daily")&&!r.includes("RESUME LISTENING")&&!r.match(/^\s*\d+\s*$/)&&!r.match(/^[A-Z\s]+$/)&&!r.match(/^\d+\s*(SECONDS|MINUTES|HOURS)$/i)&&r.split(" ").length>3?(h+=r+" ",console.log(`✓ Added fallback paragraph ${n} to content`)):console.log(`✗ Skipped fallback paragraph ${n} (length: ${r.length}, words: ${r.split(" ").length})`)})}h.length<200&&a.querySelectorAll("div, span").forEach(l=>{const n=l.innerText.trim();n.length>30&&!n.includes("Advertisement")&&!n.includes("©")&&n.split(" ").length>5&&(h.includes(n.substring(0,50))||(h+=n+" "))}),h.length<200&&(h=a.innerText||"");const D=a.querySelectorAll("a").length;let A=h.replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim();const b=A.split(/\s+/).filter(o=>o.length>0).length;if(console.log("=== CONTENT EXTRACTION DEBUG ==="),console.log("Article tag found:",!!e),console.log("Article tag selector used:",(e==null?void 0:e.tagName)||"none"),console.log("Storytext div found:",!!g),console.log("Clean content length:",h.length),console.log("Final content length:",A.length),console.log("Word count:",b,"Link count:",D),console.log("Content preview:",A.substring(0,300)+"..."),console.log("================================"),b<100||b>5e3){t({error:"Not a valid article: must have 100-5000 words. This article has "+b+" words."});return}const M={title:document.title,content:A,url:window.location.href,wordCount:b};t({success:!0,data:M})}catch(e){console.error("Content script error:",e),t({error:"Failed to extract page content."})}}}},S=(q=(C=globalThis.browser)==null?void 0:C.runtime)!=null&&q.id?globalThis.browser:globalThis.chrome;function w(s,...t){}const L={debug:(...s)=>w(console.debug,...s),log:(...s)=>w(console.log,...s),warn:(...s)=>w(console.warn,...s),error:(...s)=>w(console.error,...s)},T=class T extends Event{constructor(t,e){super(T.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=e}};p(T,"EVENT_NAME",x("wxt:locationchange"));let N=T;function x(s){var t;return`${(t=S==null?void 0:S.runtime)==null?void 0:t.id}:content:${s}`}function k(s){let t,e;return{run(){t==null&&(e=new URL(location.href),t=s.setInterval(()=>{let i=new URL(location.href);i.href!==e.href&&(window.dispatchEvent(new N(i,e)),e=i)},1e3))}}}const v=class v{constructor(t,e){p(this,"isTopFrame",window.self===window.top);p(this,"abortController");p(this,"locationWatcher",k(this));p(this,"receivedMessageIds",new Set);this.contentScriptName=t,this.options=e,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return S.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,e){const i=setInterval(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearInterval(i)),i}setTimeout(t,e){const i=setTimeout(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearTimeout(i)),i}requestAnimationFrame(t){const e=requestAnimationFrame((...i)=>{this.isValid&&t(...i)});return this.onInvalidated(()=>cancelAnimationFrame(e)),e}requestIdleCallback(t,e){const i=requestIdleCallback((...c)=>{this.signal.aborted||t(...c)},e);return this.onInvalidated(()=>cancelIdleCallback(i)),i}addEventListener(t,e,i,c){var d;e==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(d=t.addEventListener)==null||d.call(t,e.startsWith("wxt:")?x(e):e,i,{...c,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),L.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:v.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){var d,a,I;const e=((d=t.data)==null?void 0:d.type)===v.SCRIPT_STARTED_MESSAGE_TYPE,i=((a=t.data)==null?void 0:a.contentScriptName)===this.contentScriptName,c=!this.receivedMessageIds.has((I=t.data)==null?void 0:I.messageId);return e&&i&&c}listenForNewerScripts(t){let e=!0;const i=c=>{if(this.verifyScriptStartedEvent(c)){this.receivedMessageIds.add(c.data.messageId);const d=e;if(e=!1,d&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",i),this.onInvalidated(()=>removeEventListener("message",i))}};p(v,"SCRIPT_STARTED_MESSAGE_TYPE",x("wxt:content-script-started"));let $=v;function G(){}function E(s,...t){}const P={debug:(...s)=>E(console.debug,...s),log:(...s)=>E(console.log,...s),warn:(...s)=>E(console.warn,...s),error:(...s)=>E(console.error,...s)};return(async()=>{try{const{main:s,...t}=u,e=new $("content",t);return await s(e)}catch(s){throw P.error('The content script "content" crashed on startup!',s),s}})()}();
content;
